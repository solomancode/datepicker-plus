import{h as e,r as t,c as n}from"./p-9ebf5457.js";const s=e=>`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,a=e=>e.split("-").map(e=>parseInt(e)),i=e=>{const[t,n,s]=a(e),i=new Date;return i.setFullYear(t),i.setMonth(n-1),i.setDate(s),i},r=e=>{const t="string"==typeof e,n=t?i(e):new Date(e);return n.setDate(n.getDate()+1),t?s(n):n},l=(e,t)=>{if(e===t)return[];const[n,s]=c([e,t]);let a=[],i=r(n);for(;i!==s;)a.length>3e3&&m({title:"Memory leak @ getDatesBetween",label:"bug",body:JSON.stringify({dateString0:e,dateString1:t},null,2)}),a.push(i),i=r(i);return[n,...a,s]},c=([e,t])=>{const n=i(e),s=i(t);return n.valueOf()-s.valueOf()>0?[t,e]:[e,t]},h=(e=[],t)=>t.map((t,n)=>e[n]||t),d=e=>{const t=Object.create({flatten(){const e=[];for(let n=1;n<=12;n++)n in this&&e.push(t[n]);return e}});return e.forEach(e=>{const[,n]=a(e);n in t?t[n].push(e):t[n]=[e]}),t},o=e=>{let t=[],n=[];return e.forEach(e=>{6===e.dayOfWeek?(t.push(e),n.push(t),t=[]):t.push(e)}),t.length&&n.push(t),n},u=e=>{let t=Object.keys(e.tags);return[g.day,e.checked?g.selected:null,e.disabled?g.disabled:null,...t.filter(t=>!0===e.tags[t])].filter(e=>e).join(" ")},m=({title:e,body:t,label:n})=>{const s="title="+encodeURIComponent(e);throw"Stopped to prevent memory leak.\n\n🐞 Create a new issue:\n"+`https://github.com/solomancode/datepicker-plus/issues/new?${"labels="+encodeURIComponent(n)}&${s}&${"body="+encodeURIComponent(t)}`},g={day:"day",year:"year",disabled:"disabled",selected:"selected",month:"month",monthName:"month-name",monthHeader:"month-header",monthContent:"month-content",week:"week",empty:"empty",weekHeader:"week-header",weekContent:"week-content",weekend:"weekend",checkbox:"checkbox",singleHeader:"single-header",highlight:"highlight"},p={selectMode:"range",selected:[],disabled:[],selectScope:0,weekHeader:"per-month",viewRange:(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),n=new Date(e.getFullYear(),e.getMonth()+1,0);return[s(t),s(n)]})(),i18n:{months:[{name:"January",abbr:"Jan"},{name:"February",abbr:"Feb"},{name:"March",abbr:"Mar"},{name:"April",abbr:"Apr"},{name:"May",abbr:"May"},{name:"June",abbr:"Jun"},{name:"July",abbr:"Jul"},{name:"August",abbr:"Aug"},{name:"September",abbr:"Sep"},{name:"October",abbr:"Oct"},{name:"November",abbr:"Nov"},{name:"December",abbr:"Dec"}],weekDays:[{name:"Sunday",abbr:"Sun",isWeekend:!0},{name:"Monday",abbr:"Mon "},{name:"Tuesday",abbr:"Tue"},{name:"Wednesday",abbr:"Wed"},{name:"Thursday",abbr:"Thu"},{name:"Friday",abbr:"Fri"},{name:"Saturday",abbr:"Sat",isWeekend:!0}]}};function b(t){return e("header",{class:g.weekHeader,part:"week-header"},t.map(({name:t,abbr:n,isWeekend:s})=>e("abbr",{class:s&&g.weekend,title:t},n)))}function w(t){const n=[];for(;t;)n.push(e("span",{class:g.empty})),t--;return n}function f(t,n){return e("section",{part:"month",class:g.month},e("header",{class:g.monthHeader,part:"month-header"},e("span",{class:g.monthName},n.i18n.months[(s=t[0]).month-1].name),s.month-1==0&&e("span",{class:g.year},s.year)),e("section",{class:g.monthContent},o(t).map((t,s)=>(function(t,n,s){return e("section",{part:"week",class:g.week},n&&b(s),e("section",{class:g.weekContent},w(t[0].dayOfWeek),t.map(function(t){return e("time",{part:"day",class:u(t),dateTime:t.dateString},e("label",null,t.day,e("input",{checked:t.checked,disabled:t.disabled,onChange:(e=>e.target.checked?this.select(t.dateString):this.deselect(t.dateString)).bind(this),class:g.checkbox,type:"checkbox",value:t.dateString})))}.bind(this)),w(6-t[t.length-1].dayOfWeek)))}).call(this,t,(e=>"per-month"===n.weekHeader&&0===e)(s),n.i18n.weekDays))));var s}const y=e=>((e,t)=>Math.ceil((e.getTime()-t.getTime())/864e5))(new Date(e),new Date),k={today:e=>0===y(e.dateString),rangeStart:e=>0===e.rangeIndex,rangeEnd:e=>{const{rangeIndex:t,rangeEndIndex:n}=e;return n>0&&t===n},connector:e=>e.rangeIndex>0&&e.rangeEndIndex!==e.rangeIndex,tomorrow:e=>1===y(e.dateString),yesterday:e=>-1===y(e.dateString),past:e=>y(e.dateString)<0,future:e=>y(e.dateString)>0};class D{constructor(e){t(this,e),this.plusConfig=p,this.registered={},this.viewElements=[],this.selected=[],this.disabled=[],this.viewList=[],this.patchConfigLists=()=>{const{months:e,weekDays:t}=p.i18n,{months:n,weekDays:s}=this.plusConfig.i18n;this.plusConfig.i18n.months=h(n,e),this.plusConfig.i18n.weekDays=h(s,t)},this.select=e=>{const{selectMode:t}=this.plusConfig;let n=[];if("single"===t?n=[e]:"multiple"===t?n=[...this.selected,e]:"range"===t&&(n=1===this.selected.length?l(this.selected[0],e):[e]),this.checkIfHasDisabled(n,this.disabled))return this.viewElements;const s=this.selectMultipleDates(n,this.viewElements);this.viewElements=this.updateTags(k,s),this.selected=n,this.onDateSelect.emit(this.selected),"range"===t&&this.selected.length>1&&this.onRangeSelect.emit(this.selected)},this.deselect=e=>{const{selectMode:t}=this.plusConfig;let n=[];"multiple"===t&&(n=this.selected.filter(t=>t!==e)),this.viewElements=this.selectMultipleDates(n,this.viewElements),this.selected=n},this.unfoldTag=(e,t)=>e in t?this.viewElements.map(t=>t.filter(t=>!0===t.tags[e])).reduce((e,t)=>[...e,...t]).map(e=>e.dateString):[e],this.onDateSelect=n(this,"onDateSelect",7),this.onDateDeselect=n(this,"onDateDeselect",7),this.onRangeSelect=n(this,"onRangeSelect",7)}updateViewElements(e){this.registerViewDates(e),this.viewElements=e.map(e=>e.map(e=>this.registered[e]))}componentWillLoad(){this.plusConfig=Object.assign({},p,this.plusConfig),this.patchConfigLists(),this.viewList=this.createViewList(this.plusConfig.viewRange),this.viewElements=this.updateTags(k,this.viewElements),this.plusConfig.disabled=this.plusConfig.disabled.map(e=>this.unfoldTag(e,k)).reduce((e,t)=>[...e,...t]),this.viewElements=this.disableMultipleDates(this.plusConfig.disabled,this.viewElements),this.plusConfig.selected.forEach(this.select)}createViewList([e,t]){const n=l(e,t);return d(n).flatten()}registerViewDates(e){return e.forEach(e=>e.forEach(e=>{const t=function(e,t){const n=new Date(t).getDay(),[s,i,r]=a(t),l=Object.create({tags:{},checked:!1,disabled:!1,year:s,month:i,day:r,dateString:t,dayOfWeek:n});return t in e?e:Object.assign({},e,{[t]:l})}(this.registered,e);this.registered=t}))}checkIfHasDisabled(e,t){const n={};return t.forEach(e=>n[e]=!0),e.some(e=>e in n)}selectMultipleDates(e,t){return t.map(t=>t.map(t=>(t.checked=e.includes(t.dateString),t.rangeIndex=t.checked?e.indexOf(t.dateString):null,t.rangeEndIndex=t.checked?e.length-1:null,t)))}disableMultipleDates(e,t){let n=[];const s=t.map(t=>t.map(t=>{const s=e.includes(t.dateString);return t.disabled=s,s&&n.push(t.dateString),t}));return this.disabled=n,s}updateTags(e,t){return console.count("TAG UPDATE --------------------------------"),t.map(t=>t.map(t=>{for(const n in e)t.tags[n]=e[n](t);return t}))}render(){return console.count("🎨 RENDER "),function(t,n){return[n.stylesheetUrl?e("link",{rel:"stylesheet",type:"text/css",href:n.stylesheetUrl}):null,e("section",{class:"dpp-container",part:"dpp-container"},[(()=>"single"===n.weekHeader&&e("header",{class:g.singleHeader},b(n.i18n.weekDays)))()||null,t.map(e=>f.call(this,e,n))])]}.call(this,this.viewElements,this.plusConfig)}static get watchers(){return{viewList:["updateViewElements"]}}static get style(){return".dpp-container{font-family:monospace}.month{border:1px solid #ccc;padding:20px}.month-header{text-transform:uppercase;font-weight:700;margin-bottom:5px}.day.selected.rangeStart{background-color:#cddc39}.day.selected.rangeEnd{background-color:#ff9800}.week-header{display:-ms-flexbox;display:flex}.single-header{padding:5px 20px}.week-header abbr{-ms-flex-positive:1;flex-grow:1;text-align:center}.week-content{display:-ms-flexbox;display:flex}.week-content>.day,.week-content>.empty{-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:80px;flex-basis:80px;text-align:center}.day{position:relative;line-height:30px}.day>label{display:block;width:100%;height:100%;cursor:pointer;-webkit-box-sizing:border-box;box-sizing:border-box}.day.disabled{color:#ccc;background-color:#f8f8f8}.day.selected{background-color:gold}.day.highlight{background-color:#7e5}.day.today{outline:1px solid #ccc}.checkbox{display:none}.month-header{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}"}}export{D as datepicker_plus};