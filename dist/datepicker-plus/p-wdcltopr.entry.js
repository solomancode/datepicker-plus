import{h as e,r as t,c as s}from"./p-9ebf5457.js";const n=e=>`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,a=e=>e.split("-").map(e=>parseInt(e)),i=e=>{const[t,s,n]=a(e),i=new Date;return i.setFullYear(t),i.setMonth(s-1),i.setDate(n),i},r=e=>{const t="string"==typeof e,s=t?i(e):new Date(e);return s.setDate(s.getDate()+1),t?n(s):s},l=(e,t)=>{const[s,n]=d(t),a=new Date(e),i=h(a,new Date(s)),r=h(a,new Date(n));return i>=0&&r<=0},c=(e,t)=>{if(e===t)return[];const[s,n]=d([e,t]);let a=[],i=r(s);for(;i!==n;)a.length>3e3&&b({title:"Memory leak @ getDatesBetween",label:"bug",body:JSON.stringify({dateString0:e,dateString1:t},null,2)}),a.push(i),i=r(i);return[s,...a,n]},d=([e,t])=>{const s=i(e),n=i(t);return s.valueOf()-n.valueOf()>0?[t,e]:[e,t]},h=(e,t)=>Math.ceil((e.getTime()-t.getTime())/864e5),o=(e=[],t)=>t.map((t,s)=>e[s]||t),u=e=>{const t=Object.create({flatten(){const e=[];for(let s=1;s<=12;s++)s in this&&e.push(t[s]);return e}});return e.forEach(e=>{const[,s]=a(e);s in t?t[s].push(e):t[s]=[e]}),t},p=e=>{let t=[],s=[];return e.forEach(e=>{6===e.dayOfWeek?(t.push(e),s.push(t),t=[]):t.push(e)}),t.length&&s.push(t),s},g=(e,t)=>{const s=new Date(e),a=s.getDate();s.setDate(a-t);const i=new Date(e),r=i.getDate();return i.setDate(r+t),[s,i].map(e=>n(e))},m=e=>{let t=Object.keys(e.tags);return[w.day,e.checked?w.selected:null,e.disabled?w.disabled:null,...t.filter(t=>!0===e.tags[t])].filter(e=>e).join(" ")},b=({title:e,body:t,label:s})=>{const n="title="+encodeURIComponent(e);throw"Stopped to prevent memory leak.\n\n🐞 Create a new issue:\n"+`https://github.com/solomancode/datepicker-plus/issues/new?${"labels="+encodeURIComponent(s)}&${n}&${"body="+encodeURIComponent(t)}`},w={day:"day",year:"year",disabled:"disabled",selected:"selected",month:"month",monthName:"month-name",monthHeader:"month-header",monthContent:"month-content",week:"week",empty:"empty",weekHeader:"week-header",weekContent:"week-content",weekend:"weekend",checkbox:"checkbox",singleHeader:"single-header",highlight:"highlight"},f={selectMode:"range",selected:[],disabled:[],selectScopeSize:0,weekHeader:"per-month",viewRange:(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0);return[n(t),n(s)]})(),i18n:{months:[{name:"January",abbr:"Jan"},{name:"February",abbr:"Feb"},{name:"March",abbr:"Mar"},{name:"April",abbr:"Apr"},{name:"May",abbr:"May"},{name:"June",abbr:"Jun"},{name:"July",abbr:"Jul"},{name:"August",abbr:"Aug"},{name:"September",abbr:"Sep"},{name:"October",abbr:"Oct"},{name:"November",abbr:"Nov"},{name:"December",abbr:"Dec"}],weekDays:[{name:"Sunday",abbr:"Sun",isWeekend:!0},{name:"Monday",abbr:"Mon "},{name:"Tuesday",abbr:"Tue"},{name:"Wednesday",abbr:"Wed"},{name:"Thursday",abbr:"Thu"},{name:"Friday",abbr:"Fri"},{name:"Saturday",abbr:"Sat",isWeekend:!0}]}},y=e=>h(new Date(e),new Date),k={today:e=>0===y(e.dateString),rangeStart:e=>0===e.rangeIndex,rangeEnd:e=>{const{rangeIndex:t,rangeEndIndex:s}=e;return s>0&&t===s},connector:e=>e.rangeIndex>0&&e.rangeEndIndex!==e.rangeIndex,tomorrow:e=>1===y(e.dateString),yesterday:e=>-1===y(e.dateString),past:e=>y(e.dateString)<0,future:e=>y(e.dateString)>0};function D(t){return e("header",{class:w.weekHeader,part:"week-header"},t.map(({name:t,abbr:s,isWeekend:n})=>e("abbr",{class:n&&w.weekend,title:t},s)))}function S(t){const s=[];for(;t;)s.push(e("span",{class:w.empty})),t--;return s}function v(t,s){return e("section",{part:"month",class:w.month},e("header",{class:w.monthHeader,part:"month-header"},e("span",{class:w.monthName},s.i18n.months[(n=t[0]).month-1].name),n.month-1==0&&e("span",{class:w.year},n.year)),e("section",{class:w.monthContent},p(t).map((t,n)=>(function(t,s,n){return e("section",{part:"week",class:w.week},s&&D(n),e("section",{class:w.weekContent},S(t[0].dayOfWeek),t.map(function(t){return e("time",{part:"day",class:m(t),dateTime:t.dateString},e("label",null,t.day,e("input",{checked:t.checked,disabled:t.disabled,onChange:(e=>e.target.checked?this.select(t.dateString):this.deselect(t.dateString)).bind(this),class:w.checkbox,type:"checkbox",value:t.dateString})))}.bind(this)),S(6-t[t.length-1].dayOfWeek)))}).call(this,t,(e=>"per-month"===s.weekHeader&&0===e)(n),s.i18n.weekDays))));var n}class E{constructor(e){t(this,e),this.plusConfig=f,this.registered={},this.viewElements=[],this.selected=[],this.disabled=[],this.viewList=[],this.activeScope=null,this.unfoldDisabledList=e=>e.length?e.map(e=>this.unfoldTag(e,k)).reduce((e,t)=>[...e,...t]):[],this.patchConfigLists=()=>{const{months:e,weekDays:t}=f.i18n,{months:s,weekDays:n}=this.plusConfig.i18n;this.plusConfig.i18n.months=o(s,e),this.plusConfig.i18n.weekDays=o(n,t)},this.select=e=>{const{selectMode:t}=this.plusConfig;let s=[];if("single"===t?s=[e]:"multiple"===t?s=[...this.selected,e]:"range"===t&&(s=this.selected.includes(e)?[]:1===this.selected.length?c(this.selected[0],e):[e]),this.checkIfHasDisabled(s,this.disabled))return this.viewElements;const n=this.plusConfig.selectScopeSize;"range"===t&&n>0&&(this.activeScope?this.activeScope.deactivate():(this.activeScope=this.generateScope(this.viewElements,this.disabled),this.activeScope.activate(e,n)));const a=this.selectMultipleDates(s,this.viewElements);this.viewElements=this.updateTags(k,a),this.selected=s,this.onDateSelect.emit(this.selected),"range"===t&&this.selected.length>1&&this.onRangeSelect.emit(this.selected)},this.deselect=e=>{const{selectMode:t}=this.plusConfig;let s=[];"multiple"===t&&(s=this.selected.filter(t=>t!==e)),"range"===t&&this.activeScope&&this.activeScope.deactivate(),this.viewElements=this.selectMultipleDates(s,this.viewElements),this.selected=s},this.unfoldTag=(e,t)=>e in t?this.viewElements.map(t=>t.filter(t=>!0===t.tags[e])).reduce((e,t)=>[...e,...t]).map(e=>e.dateString):[e],this.onDateSelect=s(this,"onDateSelect",7),this.onDateDeselect=s(this,"onDateDeselect",7),this.onRangeSelect=s(this,"onRangeSelect",7)}updateViewElements(e){this.registerViewDates(e),this.viewElements=e.map(e=>e.map(e=>this.registered[e]))}componentWillLoad(){this.plusConfig=Object.assign({},f,this.plusConfig),this.patchConfigLists(),this.viewList=this.createViewList(this.plusConfig.viewRange),this.updateTags(k,this.viewElements),this.plusConfig.disabled=this.unfoldDisabledList(this.plusConfig.disabled),this.disableMultipleDates(this.plusConfig.disabled,this.viewElements),this.plusConfig.selected.forEach(this.select)}createViewList([e,t]){const s=c(e,t);return u(s).flatten()}registerViewDates(e){return e.forEach(e=>e.forEach(e=>{const t=function(e,t){const s=new Date(t).getDay(),[n,i,r]=a(t),l=Object.create({tags:{},checked:!1,disabled:!1,year:n,month:i,day:r,dateString:t,dayOfWeek:s});return t in e?e:Object.assign({},e,{[t]:l})}(this.registered,e);this.registered=t}))}generateScope(e,t){let s=[];return{activate:(t,n)=>{const a=g(t,n);return e.map(e=>e.map(e=>(l(e.dateString,a)?e.disabled=!1:(e.disabled=!0,this.disabled.push(e.dateString)),this.disabled=s,e)))},deactivate:()=>{const e=this.disableMultipleDates(t,this.viewElements);return this.activeScope=null,e}}}checkIfHasDisabled(e,t){const s={};return t.forEach(e=>s[e]=!0),e.some(e=>e in s)}selectMultipleDates(e,t){return t.map(t=>t.map(t=>(t.checked=e.includes(t.dateString),t.rangeIndex=t.checked?e.indexOf(t.dateString):null,t.rangeEndIndex=t.checked?e.length-1:null,t)))}disableMultipleDates(e,t){let s=[];const n=t.map(t=>t.map(t=>{const n=e.includes(t.dateString);return t.disabled=n,n&&s.push(t.dateString),t}));return this.disabled=s,n}updateTags(e,t){return t.map(t=>t.map(t=>{for(const s in e)t.tags[s]=e[s](t);return t}))}render(){return function(t,s){return[s.stylesheetUrl?e("link",{rel:"stylesheet",type:"text/css",href:s.stylesheetUrl}):null,e("section",{class:s.stylesheetUrl?"":"dpp",part:"dpp-container"},[(()=>"single"===s.weekHeader&&e("header",{class:w.singleHeader},D(s.i18n.weekDays)))()||null,t.map(e=>v.call(this,e,s))])]}.call(this,this.viewElements,this.plusConfig)}static get watchers(){return{viewList:["updateViewElements"]}}static get style(){return".dpp{font-family:monospace}.month{border:1px solid #ccc;padding:20px}.dpp .month-header{text-transform:uppercase;font-weight:700;margin-bottom:5px}.dpp .day.selected.rangeStart{background-color:#cddc39}.dpp .day.selected.rangeEnd{background-color:#ff9800}.week-header{display:-ms-flexbox;display:flex}.single-header{padding:5px 20px}.week-header abbr{-ms-flex-positive:1;flex-grow:1;text-align:center}.week-content{display:-ms-flexbox;display:flex}.week-content>.day,.week-content>.empty{-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:80px;flex-basis:80px;text-align:center}.day{position:relative;line-height:30px}.day>label{display:block;width:100%;height:100%;cursor:pointer;-webkit-box-sizing:border-box;box-sizing:border-box}.day.disabled{color:#ccc;background-color:#f8f8f8}.dpp .day.selected{background-color:gold}.dpp .day.highlight{background-color:#7e5}.dpp .day.today{outline:1px solid #ccc}.checkbox{display:none}.month-header{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}"}}export{E as datepicker_plus};