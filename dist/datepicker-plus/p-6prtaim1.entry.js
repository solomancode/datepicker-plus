import{h as e,r as t,c as s}from"./p-9ebf5457.js";const a=e=>`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,n=e=>e.split("-").map(e=>parseInt(e)),i=e=>{const[t,s,a]=n(e),i=new Date;return i.setFullYear(t),i.setMonth(s-1),i.setDate(a),i},r=e=>{const t="string"==typeof e,s=t?i(e):new Date(e);return s.setDate(s.getDate()+1),t?a(s):s},l=(e,t)=>e.getDate()===t.getDate()&&e.getUTCMonth()===t.getUTCMonth()&&e.getFullYear()===t.getFullYear(),h=e=>{let t=[],s=[];return e.forEach(e=>{6===e.dayOfWeek?(t.push(e),s.push(t),t=[]):t.push(e)}),t.length&&s.push(t),s},c=(e,t)=>{if(e===t)return[];const[s,a]=o([e,t]);let n=[],i=r(s);for(;i!==a;)n.length>3e3&&u({title:"Memory leak @ getDatesBetween",label:"bug",body:JSON.stringify({dateString0:e,dateString1:t},null,2)}),n.push(i),i=r(i);return n},o=([e,t])=>{const s=i(e),a=i(t);return s.valueOf()-a.valueOf()>0?[t,e]:[e,t]},d=(e,t)=>Math.ceil((e.getTime()-t.getTime())/864e5),g=(e=[],t)=>t.map((t,s)=>e[s]||t),u=({title:e,body:t,label:s})=>{const a="title="+encodeURIComponent(e);throw"Stopped to prevent memory leak.\n\n🐞 Create a new issue:\n"+`https://github.com/solomancode/datepicker-plus/issues/new?${"labels="+encodeURIComponent(s)}&${a}&${"body="+encodeURIComponent(t)}`},p={day:"day",year:"year",disabled:"disabled",selected:"selected",month:"month",monthName:"month-name",monthHeader:"month-header",monthContent:"month-content",week:"week",empty:"empty",weekHeader:"week-header",weekContent:"week-content",weekend:"weekend",checkbox:"checkbox",singleHeader:"single-header",highlight:"highlight"},b={selectMode:"range",selected:[],disabled:[],selectScope:0,weekHeader:"per-month",viewRange:(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0);return[a(t),a(s)]})(),i18n:{months:[{name:"January",abbr:"Jan"},{name:"February",abbr:"Feb"},{name:"March",abbr:"Mar"},{name:"April",abbr:"Apr"},{name:"May",abbr:"May"},{name:"June",abbr:"Jun"},{name:"July",abbr:"Jul"},{name:"August",abbr:"Aug"},{name:"September",abbr:"Sep"},{name:"October",abbr:"Oct"},{name:"November",abbr:"Nov"},{name:"December",abbr:"Dec"}],weekDays:[{name:"Sunday",abbr:"Sun",isWeekend:!0},{name:"Monday",abbr:"Mon "},{name:"Tuesday",abbr:"Tue"},{name:"Wednesday",abbr:"Wed"},{name:"Thursday",abbr:"Thu"},{name:"Friday",abbr:"Fri"},{name:"Saturday",abbr:"Sat",isWeekend:!0}]}},m=({date:t})=>e("time",{part:"day",class:t.classListString,dateTime:t.dateString()},e("label",{onMouseEnter:(()=>t.datepickerPlus.highlighted=t.dateString()).bind(void 0),onMouseLeave:(()=>t.datepickerPlus.highlighted=null).bind(void 0)},t.day,e("input",{ref:e=>t.el=e,onChange:e=>(e=>{const s=t.dateString(),{select:a,deselect:n}=t.datepickerPlus;e.target.checked?(t.datepickerPlus.activateSelectScope(t),a(s)):(t.datepickerPlus.deactivateSelectScope(),n(s)),t.datepickerPlus.highlighted="rangeSelect"})(e),checked:t.checked,disabled:t.disabled,class:p.checkbox,type:"checkbox",value:t.dateString()})));function f(t){return e(m,{date:t})}function S(t){return e("header",{class:p.weekHeader,part:"week-header"},t.map(({name:t,abbr:s,isWeekend:a})=>e("abbr",{class:a&&p.weekend,title:t},s)))}function k(t){const s=[];for(;t;)s.push(e("span",{class:p.empty})),t--;return s}const y=Object.freeze({today:(e,t)=>{const s=0===e.offset();return s&&t("today"),s},tomorrow:e=>1===e.offset(),yesterday:e=>-1===e.offset(),past:e=>e.offset()<0,future:e=>e.offset()>0,rangeStart:(e,t)=>{const s=0===e.rangeIndex;return s&&t("range-start"),s},rangeEnd:(e,t)=>(e.rangeEnd&&t("range-end"),e.rangeEnd),connector:(e,t)=>{const s=e.rangeIndex>0&&!e.rangeEnd;return s&&t("connector"),s}}),D=e=>Object.assign({checked:!1,disabled:!1},e),w=e=>({dateObject:()=>i(e),dateString:()=>e,offset(){const e=this.dateObject(),t=new Date;return d(e,t)}}),C=()=>({classListString:p.day,updateClassListString(){const e=this,t=[p.day,e.highlight&&p.highlight,e.disabled&&p.disabled,e.checked&&p.selected];for(const s in y)(0,y[s])(e,e=>t.push(e))&&Object.defineProperty(e.tags,s,{value:!0});const s=t.filter(e=>e).join(" ");return e.el&&e.el.parentElement.parentElement.setAttribute("class",s),this.classListString=s}}),O={};class M{constructor(e){t(this,e),this.plusConfig=b,this.selected=[],this.disabled=[],this.rangeStart=null,this._disabled=[],this.setHighlight=(e,t)=>{const s=this.getDateElement(e);s&&!s.disabled&&(s.highlight=t),s.updateClassListString()},this.unfoldTag=e=>e in y?this.viewList.map(t=>t.filter(t=>e in t.tags)).reduce((e,t)=>[...e,...t]).map(e=>e.dateString()):[e],this.addRangeMark=e=>{if(null===this.rangeStart)this.rangeStart=e,this.selected=[e],this.onDateSelect.emit(this.getDateElement(e));else if(this.rangeStart!==e){const t=this.rangeStart,s=e,a=[t,...c(t,s),s];a.some(e=>{const t=this.getDateElement(e);if(t&&t.disabled)return!0})?(this.rangeStart=s,this.selected=[s],this.onDateSelect.emit(this.getDateElement(s))):(this.rangeStart=null,this.selected=a,this.onRangeSelect.emit(a))}},this.activateSelectScope=e=>{const t=e.dateObject(),s=this.plusConfig.selectScope;if(s>0&&!this.rangeStart){this._disabled=this.plusConfig.disabled;const e=this.viewList.reduce((e,t)=>[...e,...t]).map(e=>{const a=d(t,e.dateObject());return Math.abs(a)>s&&e.dateString()}).filter(e=>e);this.disabled=e}},this.deactivateSelectScope=()=>{this.disabled=this._disabled},this.resetRangeMarks=()=>{this.rangeStart=null,this.selected=[]},this.select=e=>{const t=this.getDateElement(e);if(t)switch(this.plusConfig.selectMode){case"single":this.selected=[e],this.onDateSelect.emit(t);break;case"multiple":this.selected=[...this.selected,e],this.onDateSelect.emit(t);break;case"range":this.addRangeMark(e)}},this.deselect=e=>{const t=this.getDateElement(e);t&&("range"===this.plusConfig.selectMode?this.resetRangeMarks():this.selected=this.selected.filter(t=>t!==e),this.onDateDeselect.emit(t))},this.patchConfigLists=()=>{const{months:e,weekDays:t}=b.i18n,{months:s,weekDays:a}=this.plusConfig.i18n;this.plusConfig.i18n.months=g(s,e),this.plusConfig.i18n.weekDays=g(a,t)},this.unfoldSelected=(e,t)=>{if(!e.length)return[];let s=e.map(this.unfoldTag).reduce((e,t)=>[...e,...t]);return"range"===t?[s[0],s[s.length-1]]:s},this.getDateElement=e=>e in O?O[e]:null,this.MemProtect=0,this.createDate=e=>(function({dateString:e,options:t,datepickerPlus:s}){const[a,i,r]=n(e),l=Object.create(Object.assign({tags:{},datepickerPlus:s,createdDateElements:O},D(t),w(e),C()));if(e in O){const t=O[e];return Object.assign(t,l),t}const h=new Date(e).getDay(),c=Object.assign(l,{year:a,month:i,day:r,dayOfWeek:h});return c.updateClassListString(),Object.defineProperty(O,e,{value:c}),c})({dateString:a(e),datepickerPlus:this}),this.onDateSelect=s(this,"onDateSelect",7),this.onDateDeselect=s(this,"onDateDeselect",7),this.onRangeSelect=s(this,"onRangeSelect",7)}highlight(e,t){if("rangeSelect"===t)return;const s=null===e?t:e;let a=this.rangeStart;"rangeSelect"===e?this.selected.length&&this.selected.forEach(e=>this.setHighlight(e,!1)):a&&[a,...c(a,s),s].forEach(t=>this.setHighlight(t,null!==e))}parseSelected(e,t){const s="range"===this.plusConfig.selectMode,a=t.length-1,n=e.length-1;t.forEach((e,t)=>{this.updateDateOptions(e,Object.assign({checked:!1},s?Object.assign({rangeIndex:null},t===a?{rangeEnd:null}:{}):{}))});const i=d(new Date(e[0]),new Date(e[e.length-1]))>0;e.forEach((t,a)=>{const r=i?e.length-a-1:a;this.updateDateOptions(t,Object.assign({checked:!0},s?Object.assign({rangeIndex:r},r===n&&0!==n?{rangeEnd:!0}:{}):{}))})}parseDisabled(e,t){t.forEach(e=>this.updateDateOptions(e,{disabled:!1})),(e=e.length?e.map(e=>this.unfoldTag(e)).reduce((e,t)=>[...e,...t]):[]).forEach(e=>this.updateDateOptions(e,{disabled:!0}))}updateDateOptions(e,t){const s=this.getDateElement(e);s&&(Object.assign(s,t),s.updateClassListString())}updateConfig(e){this.parseViewRange(e.viewRange),this.unfoldSelected(e.selected,e.selectMode).forEach(this.select),this.disabled=this.plusConfig.disabled,this._disabled=this.plusConfig.disabled}componentWillLoad(){this.plusConfig=Object.assign({},b,this.plusConfig),this.patchConfigLists()}protectMemLeak(){if(this.MemProtect++,this.MemProtect>3e3){const e="#### "+(new Date).toDateString(),t="```",s=JSON.stringify(this.plusConfig,null,2);u({title:"Memory leak @ render while loop",body:e+"\n"+t+s+t,label:"bug"})}}parseViewRange(e){let t=null,s=[];const a=[];let[n,h]=e.map(i),c=r(h);for(;!l(n,c);){this.protectMemLeak();const e=this.createDate(n);null!==t&&t!==e.month?(a.push(s),s=[]):(s.push(e),n=r(n)),t=e.month}a.push(s),this.viewList=a,this.MemProtect=0}render(){return console.count("RENDER:"),t=this.viewList,[(s=this.plusConfig).stylesheetUrl?e("link",{rel:"stylesheet",type:"text/css",href:s.stylesheetUrl}):null,e("section",{class:"dpp-container",part:"dpp-container"},[(()=>"single"===s.weekHeader&&e("header",{class:p.singleHeader},S(s.i18n.weekDays)))()||null,t.map(t=>(function(t,s){return e("section",{part:"month",class:p.month},e("header",{class:p.monthHeader,part:"month-header"},e("span",{class:p.monthName},s.i18n.months[(a=t[0]).month-1].name),a.month-1==0&&e("span",{class:p.year},a.year)),e("section",{class:p.monthContent},h(t).map((t,a)=>(function(t,a){return e("section",{part:"week",class:p.week},a&&S(s.i18n.weekDays),e("section",{class:p.weekContent},k(t[0].dayOfWeek),t.map(f),k(6-t[t.length-1].dayOfWeek)))})(t,(e=>"per-month"===s.weekHeader&&0===e)(a)))));var a})(t,s))])];var t,s}static get watchers(){return{highlighted:["highlight"],selected:["parseSelected"],disabled:["parseDisabled"],plusConfig:["updateConfig"]}}static get style(){return".dpp-container{font-family:monospace}.month{border:1px solid #ccc;padding:20px}.month-header{text-transform:uppercase;font-weight:700;margin-bottom:5px}.week-header{display:-ms-flexbox;display:flex}.single-header{padding:5px 20px}.week-header abbr{-ms-flex-positive:1;flex-grow:1;text-align:center}.week-content{display:-ms-flexbox;display:flex}.week-content>.day,.week-content>.empty{-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:80px;flex-basis:80px;text-align:center}.day{line-height:30px}.day>label{display:block;width:100%;height:100%;cursor:pointer;-webkit-box-sizing:border-box;box-sizing:border-box}.day.disabled{background-color:#ccc}.day.selected{background-color:gold}.day.highlight{background-color:#7e5}.day.today{background-color:#e45}.checkbox{display:none}.month-header{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}"}}export{M as datepicker_plus};