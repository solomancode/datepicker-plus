import{h as e,r as t,c as s}from"./p-7eddb680.js";const n=e=>{const t=e.getFullYear(),s=e.getMonth()+1,n=e.getDate();return a(`${t}-${s}-${n}`)},i=e=>{const t=new Date(e);return t.setDate(t.getDate()+1),n(t)},a=e=>e.split("-").map(e=>e.padStart(2,"0")).join("-"),r=(e,t)=>{const[s,n]=h([e,t]).map(a);if(s===n)return[];let r=[],l=i(s);for(;l!==n;)r.length>3e3&&u({title:"Memory leak @ utils.unfoldRange()",label:"bug",body:JSON.stringify({dateString0:e,dateString1:t},null,2)}),r.push(l),l=i(l);return[s,...r,n]},h=([e,t])=>{const s=new Date(e),n=new Date(t);return s.valueOf()-n.valueOf()>0?[t,e]:[e,t]},l=(e=[],t)=>t.map((t,s)=>e[s]||t),o=e=>{const t=Object.create({sorted:{years:[],months:{}},toArray(){let e=[];return this.sorted.years.forEach(t=>{const s=Object.values(this[t]);s.length&&(e=[...e,...s])}),e}});e.forEach(e=>{const s=new Date(e),n=s.getFullYear(),i=s.getMonth()+1;!1===t.hasOwnProperty(n)&&(t[n]={},t.sorted.years.push(n)),!1===t[n].hasOwnProperty(i)&&(t[n][i]=[],t.sorted.months.hasOwnProperty(n)?t.sorted.months[n].push(i):t.sorted.months[n]=[i]),t[n][i].push(e)}),t.sorted.years=t.sorted.years.sort((e,t)=>e-t);for(const e in t.sorted.months)t.sorted.months[e]=t.sorted.months[e].sort((e,t)=>e-t);return t},d=e=>{let t=new Date(e);return!isNaN(t.getDate())},c=e=>{let t=[],s=[];return e.forEach(e=>{6===e.dayOfWeek?(t.push(e),s.push(t),t=[]):t.push(e)}),t.length&&s.push(t),s},g=(e,t)=>{const s=new Date(e),i=s.getDate();s.setDate(i-t);const a=new Date(e),r=a.getDate();return a.setDate(r+t),[s,a].map(e=>n(e))},u=({title:e,body:t,label:s})=>{const n="title="+encodeURIComponent(e);throw"Stopped to prevent memory leak.\n\n🐞 Create a new issue:\n"+`https://github.com/solomancode/datepicker-plus/issues/new?${"labels="+encodeURIComponent(s)}&${n}&${"body="+encodeURIComponent(t)}`},p={day:"day",year:"year",disabled:"disabled",selected:"selected",month:"month",months:"months",monthName:"month-name",monthHeader:"month-header",monthContent:"month-content",week:"week",empty:"empty",weekHeader:"week-header",weekContent:"week-content",weekend:"weekend",checkbox:"checkbox",singleHeader:"single-header",highlight:"highlight"},m={selectMode:"range",selected:[],disabled:[],selectScopeSize:0,weekHeader:"per-month",viewRange:(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),s=new Date(e.getFullYear(),e.getMonth()+1,0);return[n(t),n(s)]})(),i18n:{months:[{name:"January",abbr:"Jan"},{name:"February",abbr:"Feb"},{name:"March",abbr:"Mar"},{name:"April",abbr:"Apr"},{name:"May",abbr:"May"},{name:"June",abbr:"Jun"},{name:"July",abbr:"Jul"},{name:"August",abbr:"Aug"},{name:"September",abbr:"Sep"},{name:"October",abbr:"Oct"},{name:"November",abbr:"Nov"},{name:"December",abbr:"Dec"}],weekDays:[{name:"Sunday",abbr:"Sun",isWeekend:!0},{name:"Monday",abbr:"Mon "},{name:"Tuesday",abbr:"Tue"},{name:"Wednesday",abbr:"Wed"},{name:"Thursday",abbr:"Thu"},{name:"Friday",abbr:"Fri"},{name:"Saturday",abbr:"Sat",isWeekend:!0}]},layout:"vertical"},b=e=>((e,t)=>Math.ceil((e.getTime()-t.getTime())/864e5))(new Date(e),new Date),D={today:e=>0===b(e.dateString),rangeStart:e=>0===e.getAttr("rangeIndex"),rangeEnd:e=>{const t=e.getAttr("rangeIndex"),s=e.getAttr("rangeEndIndex");return s>0&&t===s},connector:e=>e.getAttr("rangeIndex")>0&&e.getAttr("rangeEndIndex")!==e.getAttr("rangeIndex"),tomorrow:e=>1===b(e.dateString),yesterday:e=>-1===b(e.dateString),past:e=>b(e.dateString)<0,future:e=>b(e.dateString)>0};class y{constructor(e){this.dateString=e,this.pendingQueue=[],this.attributes=({}={}),this.date=new Date(e),this.day=this.date.getDate(),this.month=this.date.getMonth()+1,this.year=this.date.getFullYear(),this.dayOfWeek=this.date.getDay(),this.updateAttributes(D)}hookDOMElement(e){e instanceof HTMLTimeElement?this.DateDOMElement=e:e instanceof HTMLInputElement&&(this.checkboxDOMElement=e),this.pendingQueue=this.pendingQueue.filter(e=>!1===e.call(this))}updateDateClasses(){return this.DateDOMElement?(this.DateDOMElement.setAttribute("class",p.day+" "+Object.keys(this.attributes).filter(e=>!0===this.attributes[e]).join(" ")),!0):(this.pendingQueue.push(this.updateDateClasses),!0)}updateCheckboxAttribute(e,t){this.checkboxDOMElement?this.checkboxDOMElement[e]=t:this.pendingQueue.push(()=>!!this.checkboxDOMElement&&(this.checkboxDOMElement[e]=t,this.updateDateClasses(),!0)),this.updateDateClasses()}updateDOMAttribute(e,t){"checked"!==e&&"disabled"!==e||this.updateCheckboxAttribute(e,t),this.updateDateClasses()}setAttr(e,t){this.attributes[e]=t,this.updateDOMAttribute(e,t)}getAttr(e){return this.attributes[e]}hasAttr(e){return e in this.attributes}removeAttr(e){delete this.attributes[e],this.updateDateClasses()}resetRangeAttributes(){this.removeAttr("rangeIndex"),this.removeAttr("rangeEndIndex"),this.removeAttr("rangeStart"),this.removeAttr("rangeEnd"),this.removeAttr("connector")}updateAttributes(e){for(const t in e)e.hasOwnProperty(t)&&!0===(0,e[t])(this)&&this.setAttr(t,!0)}}function f(t){return e("header",{class:p.weekHeader,part:"week-header"},t.map(({name:t,abbr:s,isWeekend:n})=>e("abbr",{class:n&&p.weekend,title:t},s)))}function w(t){const s=[];for(;t;)s.push(e("span",{class:p.empty})),t--;return s}function k(t,s){const n="horizontal"===s.layout?{width:window.innerWidth-60+"px"}:{};return e("section",{style:n,part:"month",class:p.month},e("header",{class:p.monthHeader,part:"month-header"},e("span",{class:p.monthName},s.i18n.months[(i=t[0]).month-1].name),i.month-1==0&&e("span",{class:p.year},i.year)),e("section",{class:p.monthContent},c(t).map((t,n)=>(function(t,s,n){return e("section",{part:"week",class:p.week},s&&f(n),e("section",{class:p.weekContent},w(t[0].dayOfWeek),t.map(function(t){return e("time",{part:"day",dateTime:t.dateString,onMouseEnter:(()=>!1===t.getAttr("disabled")&&this.highlightON(t.dateString)).bind(this),ref:e=>t.hookDOMElement(e)},e("label",null,t.day,e("input",{ref:e=>t.hookDOMElement(e),onChange:(e=>e.target.checked?this.select(t.dateString):this.deselect([t.dateString])).bind(this),class:p.checkbox,type:"checkbox",value:t.dateString})))}.bind(this)),w(6-t[t.length-1].dayOfWeek)))}).call(this,t,(e=>"per-month"===s.weekHeader&&0===e)(n),s.i18n.weekDays))));var i}class E{constructor(e){t(this,e),this.plusConfig=m,this.dateRegistry={},this.viewElements=[],this.selected=[],this.disabled=[],this.highlighted=[],this.activeScope=null,this.unfoldDateStringList=e=>e.length?e.map(e=>d(e)?[e]:this.unfoldAttribute(e)).reduce((e,t)=>[...e,...t]):[],this.patchConfigLists=()=>{const{months:e,weekDays:t}=m.i18n,{months:s,weekDays:n}=this.plusConfig.i18n;this.plusConfig.i18n.months=l(s,e),this.plusConfig.i18n.weekDays=l(n,t)},this.select=e=>{const{selectMode:t}=this.plusConfig;let s=[];if("single"===t?s=[e]:"multiple"===t?s=[...this.selected,e]:"range"===t&&(s=this.selected.includes(e)?[]:1===this.selected.length?r(this.selected[0],e):[e]),this.checkIfHasDisabled(s,this.disabled))return this.viewElements;const n=this.plusConfig.selectScopeSize;"range"===t&&n>0&&(this.activeScope?this.activeScope.deactivate():(this.activeScope=this.generateScope(this.disabled),this.activeScope.activate(e,n))),this.deselect(this.selected),this.selectMultipleDates(s),this.onDateSelect.emit(this.selected),"range"===t&&this.selected.length>1&&this.onRangeSelect.emit(this.selected)},this.deselect=e=>{const{selectMode:t}=this.plusConfig;"range"===t&&(e=this.selected,this.activeScope&&1===e.length&&this.activeScope.deactivate()),e.forEach(e=>{const s=this.getDateElement(e);s.setAttr("checked",!1),"range"===t&&s.resetRangeAttributes(),s.updateDateClasses()}),this.selected=this.selected.filter(t=>!e.includes(t)),this.clearHighlighted(),this.onDeselect.emit(e)},this.getDateElement=e=>{const t=a(e);return this.dateRegistry[t]},this.unfoldAttribute=e=>{const t=[];return this.viewElements.reduce((e,t)=>[...e,...t]).forEach(s=>{s.getAttr(e)&&t.push(s.dateString)}),t},this.registerDate=e=>{const t=a(e);if(t in this.dateRegistry)return this.dateRegistry[t];const s=new y(t);return this.dateRegistry[t]=s,s},this.onDateSelect=s(this,"onDateSelect",7),this.onDeselect=s(this,"onDeselect",7),this.onRangeSelect=s(this,"onRangeSelect",7),this.onHighlight=s(this,"onHighlight",7),this.onHighlightClear=s(this,"onHighlightClear",7)}componentWillLoad(){this.plusConfig=Object.assign({},m,this.plusConfig),this.patchConfigLists(),"horizontal"===this.plusConfig.layout&&(this.plusConfig.weekHeader="per-month")}componentDidLoad(){const e=this.unfoldViewRange(this.plusConfig.viewRange).map(e=>e.map(this.registerDate));this.viewElements=e;const t=this.unfoldDateStringList(this.plusConfig.disabled);this.disableMultipleDates(t),this.plusConfig.selected.forEach(this.select)}unfoldViewRange([e,t]){const s=r(e,t);return o(s).toArray()}generateScope(e){return{activate:(e,t)=>{const[s,n]=g(e,t),[i,a]=this.plusConfig.viewRange,h=[...r(i,s),...r(n,a)];this.disableMultipleDates(h)},deactivate:()=>{this.enableMultipleDates(this.disabled),this.disableMultipleDates(e),this.activeScope=null}}}highlightON(e){"range"===this.plusConfig.selectMode&&1===this.selected.length&&(this.clearHighlighted(),this.highlighted=r(this.selected[0],e),this.highlighted.forEach(e=>{this.getDateElement(e).setAttr("highlighted",!0)}),this.onHighlight.emit(this.highlighted))}clearHighlighted(){this.highlighted.forEach(e=>{const t=this.getDateElement(e);t&&t.removeAttr("highlighted")}),this.highlighted=[],this.onHighlightClear.emit(void 0)}checkIfHasDisabled(e,t){const s={};return t.forEach(e=>s[e]=!0),e.some(e=>e in s)}selectMultipleDates(e){e.forEach(t=>{const s=this.getDateElement(t);if(s){if(s.setAttr("checked",!0),e.length>1){const t=s.getAttr("checked");s.setAttr("rangeIndex",t?e.indexOf(s.dateString):null),s.setAttr("rangeEndIndex",t?e.length-1:null)}if("range"===this.plusConfig.selectMode){const{rangeStart:e,rangeEnd:t,connector:n}=D;s.updateAttributes({rangeStart:e,rangeEnd:t,connector:n})}}}),this.selected=e}disableMultipleDates(e){this.disabled=e.filter(e=>{const t=this.getDateElement(e);return!!t&&(t.setAttr("disabled",!0),!0)})}enableMultipleDates(e){e.forEach(e=>{const t=this.getDateElement(e);t&&t.setAttr("disabled",!1)}),this.disabled=this.disabled.filter(t=>!e.includes(t))}render(){return console.count("RENDER..."),function(t,s){const n="horizontal"===s.layout?{width:window.innerWidth*t.length+"px"}:{};return[s.stylesheetUrl?e("link",{rel:"stylesheet",type:"text/css",href:s.stylesheetUrl}):null,e("section",{class:(s.stylesheetUrl?"":"dpp ")+s.layout,part:"dpp-container"},e("section",{style:n,class:"viewport"},[(()=>"single"===s.weekHeader&&e("header",{class:p.singleHeader},f(s.i18n.weekDays)))()||null,t.map(e=>k.call(this,e,s))]))]}.call(this,this.viewElements,this.plusConfig)}static get style(){return".dpp{font-family:monospace}.horizontal{overflow-x:scroll}.horizontal .month{display:inline-block}.month{border:1px solid #ccc;padding:20px}.dpp .month-header{text-transform:uppercase;font-weight:700;margin-bottom:5px}.dpp .day.checked.rangeStart{background-color:#cddc39}.dpp .day.checked.rangeEnd{background-color:#ff9800}.week-header{display:-ms-flexbox;display:flex}.single-header{padding:5px 20px}.week-header abbr{-ms-flex-positive:1;flex-grow:1;text-align:center}.week-content{display:-ms-flexbox;display:flex}.week-content>.day,.week-content>.empty{-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:80px;flex-basis:80px;text-align:center}.day{position:relative;line-height:30px}.day>label{display:block;width:100%;height:100%;cursor:pointer;-webkit-box-sizing:border-box;box-sizing:border-box}.day.disabled{color:#ccc;background-color:#f8f8f8}.dpp .day.checked,.dpp .day.highlighted{background-color:gold}.dpp .day.today{outline:1px solid #ccc}.checkbox{display:none}.month-header{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}"}}export{E as datepicker_plus};