import{h as e,r as t,c as a}from"./p-9ebf5457.js";const s=e=>`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`,n=e=>e.split("-").map(e=>parseInt(e)),i=e=>{const[t,a,s]=n(e),i=new Date;return i.setFullYear(t),i.setMonth(a-1),i.setDate(s),i},r=e=>{const t="string"==typeof e,a=t?i(e):new Date(e);return a.setDate(a.getDate()+1),t?s(a):a},l=(e,t)=>e.getDate()===t.getDate()&&e.getUTCMonth()===t.getUTCMonth()&&e.getFullYear()===t.getFullYear(),c=e=>{let t=[],a=[];return e.forEach(e=>{6===e.dayOfWeek?(t.push(e),a.push(t),t=[]):t.push(e)}),t.length&&a.push(t),a},o=(e,t)=>{const[a,s]=d([e,t]);let n=[],i=r(a);for(;i!==s;)n.length>3e3&&u({title:"Memory leak @ getDatesBetween",label:"bug",body:JSON.stringify({dateString0:e,dateString1:t},null,2)}),n.push(i),i=r(i);return n},d=([e,t])=>{const a=i(e),s=i(t);return a.valueOf()-s.valueOf()>0?[t,e]:[e,t]},h=(e,t)=>Math.ceil((e.getTime()-t.getTime())/864e5),u=({title:e,body:t,label:a})=>{const s="title="+encodeURIComponent(e);throw"Stopped to prevent memory leak.\n\n🐞 Create a new issue:\n"+`https://github.com/solomancode/datepicker-plus/issues/new?${"labels="+encodeURIComponent(a)}&${s}&${"body="+encodeURIComponent(t)}`},g=[{name:"Sunday",abbr:"Sun",isWeekend:!0},{name:"Monday",abbr:"Mon "},{name:"Tuesday",abbr:"Tue"},{name:"Wednesday",abbr:"Wed"},{name:"Thursday",abbr:"Thu"},{name:"Friday",abbr:"Fri"},{name:"Saturday",abbr:"Sat",isWeekend:!0}],p=[{name:"January",abbr:"Jan"},{name:"February",abbr:"Feb"},{name:"March",abbr:"Mar"},{name:"April",abbr:"Apr"},{name:"May",abbr:"May"},{name:"June",abbr:"Jun"},{name:"July",abbr:"Jul"},{name:"August",abbr:"Aug"},{name:"September",abbr:"Sep"},{name:"October",abbr:"Oct"},{name:"November",abbr:"Nov"},{name:"December",abbr:"Dec"}],b={day:"day",disabled:"disabled",selected:"selected",month:"month",monthHeader:"month-header",monthContent:"month-content",week:"week",empty:"empty",weekHeader:"week-header",weekContent:"week-content",weekend:"weekend",checkbox:"checkbox"},m={selectMode:"range",selected:[],disabled:[],selectScope:0,viewRange:(()=>{const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),1),a=new Date(e.getFullYear(),e.getMonth()+1,0);return[s(t),s(a)]})()},f=({date:t})=>e("time",{part:"day",class:t.classListString,dateTime:t.dateString()},e("label",null,t.day,e("input",{ref:e=>t.el=e,onChange:e=>(e=>{const a=t.dateString(),{select:s,deselect:n}=t.datepickerPlus;e.target.checked?(t.datepickerPlus.activateSelectScope(t),s(a)):(t.datepickerPlus.deactivateSelectScope(),n(a))})(e),checked:t.checked,disabled:t.disabled,class:b.checkbox,type:"checkbox",value:t.dateString()})));function S(t){return e(f,{date:t})}function k(t){const a=[];for(;t;)a.push(e("span",{class:b.empty})),t--;return a}function D(t,a){return[a?e("link",{rel:"stylesheet",type:"text/css",href:a}):null,e("section",{class:"dpp-container",part:"dpp-container"},t.map(t=>(function(t){return e("section",{part:"month",class:b.month},e("header",{class:b.monthHeader,part:"month-header"},p[t[0].month-1].name),e("section",{class:b.monthContent},c(t).map((t,a)=>(function(t,a=!1){return e("section",{part:"week",class:b.week},a&&function(t=g){return e("header",{class:b.weekHeader,part:"week-header"},t.map(({name:t,abbr:a,isWeekend:s})=>e("abbr",{class:s&&b.weekend,title:t},a)))}(),e("section",{class:b.weekContent},k(t[0].dayOfWeek),t.map(S),k(6-t[t.length-1].dayOfWeek)))})(t,0===a))))})(t)))]}const y=Object.freeze({today:(e,t)=>{const a=0===e.offset();return a&&t("today"),a},tomorrow:e=>1===e.offset(),yesterday:e=>-1===e.offset(),past:e=>e.offset()<0,future:e=>e.offset()>0,rangeStart:(e,t)=>{const a=0===e.rangeIndex;return a&&t("range-start"),a},rangeEnd:(e,t)=>(e.rangeEnd&&t("range-end"),e.rangeEnd),connector:(e,t)=>{const a=e.rangeIndex>0&&!e.rangeEnd;return a&&t("connector"),a}}),w=e=>Object.assign({checked:!1,disabled:!1},e),O=e=>({dateObject:()=>i(e),dateString:()=>e,offset(){const e=this.dateObject(),t=new Date;return h(e,t)}}),M=()=>({classListString:b.day,updateClassListString(){const e=this,t=[b.day,e.disabled&&b.disabled,e.checked&&b.selected];for(const a in y)(0,y[a])(e,e=>t.push(e))&&Object.defineProperty(e.tags,a,{value:!0});return this.classListString=t.filter(e=>e).join(" ")}}),C={};class E{constructor(e){t(this,e),this.plusConfig=m,this.selected=[],this.disabled=[],this.rangeStart=null,this._disabled=[],this.unfoldTag=e=>e in y?this.viewList.map(t=>t.filter(t=>e in t.tags)).reduce((e,t)=>[...e,...t]).map(e=>e.dateString()):[e],this.addRangeMark=e=>{if(null===this.rangeStart)this.rangeStart=e,this.selected=[e],this.onDateSelect.emit(this.getDateElement(e));else if(this.rangeStart!==e){const t=this.rangeStart,a=e,s=[t,...o(t,a),a];s.some(e=>{const t=this.getDateElement(e);if(t&&t.disabled)return!0})?(this.rangeStart=a,this.selected=[a],this.onDateSelect.emit(this.getDateElement(a))):(this.rangeStart=null,this.selected=s,this.onRangeSelect.emit(s))}},this.activateSelectScope=e=>{const t=e.dateObject(),a=this.plusConfig.selectScope;if(a>0&&!this.rangeStart){this._disabled=this.disabled;const e=this.viewList.reduce((e,t)=>[...e,...t]).map(e=>{const s=h(t,e.dateObject());return Math.abs(s)>a&&e.dateString()}).filter(e=>e);this.disabled=e}},this.deactivateSelectScope=()=>{this.disabled=this._disabled},this.resetRangeMarks=()=>{this.rangeStart=null,this.selected=[]},this.select=e=>{const t=this.getDateElement(e);if(t)switch(this.plusConfig.selectMode){case"single":this.selected=[e],this.onDateSelect.emit(t);break;case"multiple":this.selected=[...this.selected,e],this.onDateSelect.emit(t);break;case"range":this.addRangeMark(e)}},this.deselect=e=>{const t=this.getDateElement(e);t&&("range"===this.plusConfig.selectMode?this.resetRangeMarks():this.selected=this.selected.filter(t=>t!==e),this.onDateDeselect.emit(t))},this.unfoldSelected=(e,t)=>{let a=e.map(this.unfoldTag).reduce((e,t)=>[...e,...t]);return"range"===t?[a[0],a[a.length-1]]:a},this.getDateElement=e=>e in C?C[e]:null,this.MemProtect=0,this.createDate=e=>(function({dateString:e,options:t,datepickerPlus:a}){const[s,i,r]=n(e),l=Object.create(Object.assign({tags:{},datepickerPlus:a,createdDateElements:C},w(t),O(e),M()));if(e in C){const t=C[e];return Object.assign(t,l),t}const c=new Date(e).getDay(),o=Object.assign(l,{year:s,month:i,day:r,dayOfWeek:c});return o.updateClassListString(),Object.defineProperty(C,e,{value:o}),o})({dateString:s(e),datepickerPlus:this}),this.onDateSelect=a(this,"onDateSelect",7),this.onDateDeselect=a(this,"onDateDeselect",7),this.onRangeSelect=a(this,"onRangeSelect",7)}parseSelected(e,t){const a="range"===this.plusConfig.selectMode,s=t.length-1,n=e.length-1;t.forEach((e,t)=>{this.updateDateOptions(e,Object.assign({checked:!1},a?Object.assign({rangeIndex:null},t===s?{rangeEnd:null}:{}):{}))}),e.forEach((e,t)=>{this.updateDateOptions(e,Object.assign({checked:!0},a?Object.assign({rangeIndex:t},t===n?{rangeEnd:!0}:{}):{}))})}parseDisabled(e,t){t.forEach(e=>this.updateDateOptions(e,{disabled:!1})),(e=e.map(e=>this.unfoldTag(e)).reduce((e,t)=>[...e,...t])).forEach(e=>this.updateDateOptions(e,{disabled:!0}))}updateDateOptions(e,t){const a=this.getDateElement(e);a&&(Object.assign(a,t),a.updateClassListString())}updateConfig(e){this.parseViewRange(e.viewRange),this.unfoldSelected(e.selected,e.selectMode).forEach(this.select),this.disabled=this.plusConfig.disabled,this._disabled=this.plusConfig.disabled}componentWillLoad(){this.plusConfig=Object.assign({},m,this.plusConfig)}protectMemLeak(){if(this.MemProtect++,this.MemProtect>3e3){const e="#### "+(new Date).toDateString(),t="```",a=JSON.stringify(this.plusConfig,null,2);u({title:"Memory leak @ render while loop",body:e+"\n"+t+a+t,label:"bug"})}}parseViewRange(e){let t=null,a=[];const s=[];let[n,c]=e.map(i),o=r(c);for(;!l(n,o);){this.protectMemLeak();const e=this.createDate(n);null!==t&&t!==e.month?(s.push(a),a=[]):(a.push(e),n=r(n)),t=e.month}s.push(a),this.viewList=s,this.MemProtect=0}render(){return console.count("RENDER:"),D(this.viewList,this.plusConfig.stylesheetUrl)}static get watchers(){return{selected:["parseSelected"],disabled:["parseDisabled"],plusConfig:["updateConfig"]}}static get style(){return".dpp-container{font-family:monospace}.month{border:1px solid #ccc;padding:20px}.month-header{text-transform:uppercase;font-weight:700;margin-bottom:5px}.week-header{display:-ms-flexbox;display:flex}.week-header abbr{-ms-flex-positive:1;flex-grow:1;text-align:center}.week-content{display:-ms-flexbox;display:flex}.week-content>.day,.week-content>.empty{-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:80px;flex-basis:80px;text-align:center}.day.disabled{background-color:#ccc}.day.selected{background-color:gold}.day.today{background-color:#e45}"}}export{E as datepicker_plus};